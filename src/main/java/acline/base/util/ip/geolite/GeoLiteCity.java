package acline.base.util.ip.geolite;

import java.io.File;
import java.io.IOException;
import java.net.InetAddress;
import java.net.UnknownHostException;
import java.util.*;

import acline.base.util.common.StringUtils;
import acline.base.util.data.WriterResourceExcel;
import acline.base.util.dataobject.IpCityDTO;
import cn.hutool.log.LogFactory;
import com.maxmind.geoip2.DatabaseReader;
import com.maxmind.geoip2.exception.GeoIp2Exception;
import com.maxmind.geoip2.model.CityResponse;
import com.maxmind.geoip2.record.City;
import com.maxmind.geoip2.record.Country;
import com.maxmind.geoip2.record.Subdivision;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;


/**
 * @author Aaron Chen
 * @date：2023/5/9
 * @Description:TODO
 * @Version 1.0
 */
public class GeoLiteCity {
    private static final Logger LOGGER = LoggerFactory.getLogger(GeoLiteCity.class);


    private static DatabaseReader reader;

    static {
        load();
    }

    private String ips = "";

    public static String findOne(String ip) {
        String[] ipAddrs = find(ip);
        if (ipAddrs != null && ipAddrs.length > 0) {
            StringBuilder addrBuilder = new StringBuilder();
            for (String addr : ipAddrs) {
                addrBuilder.append(addr);
            }
            return addrBuilder.toString();
        }
        return null;
    }

    public static String[] find(String ip) {
        try {
            String addr[] = new String[3];
            InetAddress ipAddress = InetAddress.getByName(ip);
            // 获取查询结果

            CityResponse response = reader.city(ipAddress);
            // 获取城市名称
            City city = response.getCity();
            addr[2] = city.getName();
            System.out.println();
            System.out.println(city.getName());
            // 获取省分名称
            Subdivision subdivision = response.getMostSpecificSubdivision();
            addr[1] = subdivision.getName();
            System.out.println(subdivision.getName());
            // 获取国家名称
            Country country = response.getCountry();
            addr[0] = country.getName();
            System.out.println(country.getName());

            return addr;
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    private static String findCity(String ip) throws IOException, GeoIp2Exception {
        InetAddress ipAddress = InetAddress.getByName(ip);

        CityResponse response = reader.city(ipAddress);
        City city = response.getCity();
        String cityName = city.getName();
        return StringUtils.isBlank(cityName) ? "" : cityName;
    }

    private static String findCountry(String ip) throws IOException, GeoIp2Exception {
        InetAddress ipAddress = InetAddress.getByName(ip);
        CityResponse response = reader.city(ipAddress);

        Country country = response.getCountry();
        String countryName = country.getName();
        System.out.println(ip+":"+countryName);
        return StringUtils.isBlank(countryName) ? "" : countryName;
    }

    private static String findSubdivision(String ip) throws IOException, GeoIp2Exception {
        InetAddress ipAddress = InetAddress.getByName(ip);
        CityResponse response = reader.city(ipAddress);
        Subdivision subdivision = response.getMostSpecificSubdivision();
        String subdivisionName = subdivision.getName();
        return  StringUtils.isBlank(subdivisionName) ? "" : subdivisionName;
    }


    /**
     * 官方的API
     */
    public static void load() {
        // A File object pointing to your GeoIP2 or GeoLite2 database
        File database = new File("/Users/aaron.chen/Downloads/GeoLite2-City.mmdb");
        try {
            reader = new DatabaseReader.Builder(database).build();

        } catch (UnknownHostException e) {
            throw new RuntimeException(e);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }


    private static void queryIpCity() throws Exception {
        Map<String,Object> allResource= new HashMap<>();
        String ipStr = "103.15.106.101,103.15.106.105,103.15.106.109,103.15.106.113,103.15.106.117,103.15.106.141,103.15.106.163,103.15.106.165,103.15.106.169,103.15.106.174,103.15.106.241,103.15.106.251,103.15.106.63,103.15.106.66,103.15.106.82,103.15.106.97,103.15.107.104,103.15.107.4,103.15.107.45,103.15.107.75,103.23.47.14,103.23.47.19,104.144.9.10,104.144.9.11,104.144.9.12,104.144.9.13,104.144.9.14,104.144.9.15,104.144.9.16,104.144.9.17,104.144.9.18,104.144.9.19,104.144.9.2,104.144.9.20,104.144.9.21,104.144.9.22,104.144.9.23,104.144.9.24,104.144.9.25,104.144.9.26,104.144.9.27,104.144.9.28,104.144.9.29,104.144.9.3,104.144.9.30,104.144.9.31,104.144.9.32,104.144.9.33,104.144.9.34,104.144.9.35,104.144.9.36,104.144.9.37,104.144.9.4,104.144.9.5,104.144.9.6,104.144.9.7,104.144.9.8,104.144.9.9,116.213.37.112,116.213.37.13,116.213.37.18,116.213.37.41,116.213.37.51,116.213.37.67,116.213.37.82,116.213.37.83,116.213.37.84,116.213.37.85,116.213.37.86,116.213.37.87,116.213.37.88,116.213.37.89,116.213.37.9,116.213.37.90,116.213.37.91,116.213.37.92,116.213.37.93,116.213.37.94,116.213.37.95,116.213.37.96,116.213.37.97,116.213.37.98,116.213.37.99,122.10.196.10,122.10.196.100,122.10.196.101,122.10.196.102,122.10.196.103,122.10.196.104,122.10.196.105,122.10.196.106,122.10.196.107,122.10.196.108,122.10.196.109,122.10.196.11,122.10.196.110,122.10.196.111,122.10.196.112,122.10.196.113,122.10.196.114,122.10.196.115,122.10.196.116,122.10.196.117,122.10.196.118,122.10.196.119,122.10.196.12,122.10.196.120,122.10.196.121,122.10.196.122,122.10.196.123,122.10.196.124,122.10.196.125,122.10.196.126,122.10.196.127,122.10.196.128,122.10.196.129,122.10.196.13,122.10.196.130,122.10.196.131,122.10.196.132,122.10.196.133,122.10.196.134,122.10.196.135,122.10.196.136,122.10.196.137,122.10.196.138,122.10.196.139,122.10.196.14,122.10.196.140,122.10.196.141,122.10.196.142,122.10.196.143,122.10.196.144,122.10.196.145,122.10.196.146,122.10.196.147,122.10.196.148,122.10.196.149,122.10.196.15,122.10.196.150,122.10.196.151,122.10.196.152,122.10.196.153,122.10.196.154,122.10.196.155,122.10.196.156,122.10.196.157,122.10.196.158,122.10.196.159,122.10.196.16,122.10.196.160,122.10.196.161,122.10.196.162,122.10.196.163,122.10.196.164,122.10.196.165,122.10.196.166,122.10.196.167,122.10.196.168,122.10.196.169,122.10.196.17,122.10.196.170,122.10.196.171,122.10.196.172,122.10.196.173,122.10.196.174,122.10.196.175,122.10.196.176,122.10.196.177,122.10.196.178,122.10.196.179,122.10.196.18,122.10.196.180,122.10.196.181,122.10.196.182,122.10.196.183,122.10.196.184,122.10.196.185,122.10.196.186,122.10.196.187,122.10.196.188,122.10.196.189,122.10.196.19,122.10.196.190,122.10.196.191,122.10.196.192,122.10.196.193,122.10.196.194,122.10.196.195,122.10.196.196,122.10.196.197,122.10.196.198,122.10.196.199,122.10.196.20,122.10.196.200,122.10.196.201,122.10.196.202,122.10.196.203,122.10.196.204,122.10.196.205,122.10.196.206,122.10.196.207,122.10.196.208,122.10.196.209,122.10.196.21,122.10.196.210,122.10.196.211,122.10.196.212,122.10.196.213,122.10.196.214,122.10.196.215,122.10.196.216,122.10.196.217,122.10.196.218,122.10.196.219,122.10.196.22,122.10.196.220,122.10.196.221,122.10.196.222,122.10.196.223,122.10.196.224,122.10.196.225,122.10.196.226,122.10.196.227,122.10.196.228,122.10.196.229,122.10.196.23,122.10.196.230,122.10.196.231,122.10.196.232,122.10.196.233,122.10.196.234,122.10.196.235,122.10.196.236,122.10.196.237,122.10.196.238,122.10.196.239,122.10.196.24,122.10.196.240,122.10.196.241,122.10.196.242,122.10.196.243,122.10.196.244,122.10.196.245,122.10.196.246,122.10.196.247,122.10.196.248,122.10.196.249,122.10.196.25,122.10.196.250,122.10.196.251,122.10.196.252,122.10.196.253,122.10.196.254,122.10.196.26,122.10.196.27,122.10.196.28,122.10.196.29,122.10.196.30,122.10.196.31,122.10.196.32,122.10.196.33,122.10.196.34,122.10.196.35,122.10.196.36,122.10.196.37,122.10.196.38,122.10.196.39,122.10.196.4,122.10.196.40,122.10.196.41,122.10.196.42,122.10.196.43,122.10.196.44,122.10.196.45,122.10.196.46,122.10.196.47,122.10.196.48,122.10.196.49,122.10.196.5,122.10.196.50,122.10.196.51,122.10.196.52,122.10.196.53,122.10.196.54,122.10.196.55,122.10.196.56,122.10.196.57,122.10.196.58,122.10.196.59,122.10.196.6,122.10.196.60,122.10.196.61,122.10.196.62,122.10.196.63,122.10.196.64,122.10.196.65,122.10.196.66,122.10.196.67,122.10.196.68,122.10.196.69,122.10.196.7,122.10.196.70,122.10.196.71,122.10.196.72,122.10.196.73,122.10.196.74,122.10.196.75,122.10.196.76,122.10.196.77,122.10.196.78,122.10.196.79,122.10.196.8,122.10.196.80,122.10.196.81,122.10.196.82,122.10.196.83,122.10.196.84,122.10.196.85,122.10.196.86,122.10.196.87,122.10.196.88,122.10.196.89,122.10.196.9,122.10.196.90,122.10.196.91,122.10.196.92,122.10.196.93,122.10.196.94,122.10.196.95,122.10.196.96,122.10.196.97,122.10.196.98,122.10.196.99,122.10.197.10,122.10.197.100,122.10.197.101,122.10.197.102,122.10.197.103,122.10.197.104,122.10.197.105,122.10.197.106,122.10.197.107,122.10.197.108,122.10.197.109,122.10.197.11,122.10.197.110,122.10.197.111,122.10.197.112,122.10.197.113,122.10.197.114,122.10.197.115,122.10.197.116,122.10.197.117,122.10.197.118,122.10.197.119,122.10.197.12,122.10.197.120,122.10.197.121,122.10.197.122,122.10.197.123,122.10.197.124,122.10.197.125,122.10.197.126,122.10.197.127,122.10.197.128,122.10.197.129,122.10.197.13,122.10.197.130,122.10.197.131,122.10.197.132,122.10.197.133,122.10.197.134,122.10.197.135,122.10.197.136,122.10.197.137,122.10.197.138,122.10.197.139,122.10.197.14,122.10.197.140,122.10.197.141,122.10.197.142,122.10.197.143,122.10.197.144,122.10.197.145,122.10.197.146,122.10.197.147,122.10.197.148,122.10.197.149,122.10.197.15,122.10.197.150,122.10.197.151,122.10.197.152,122.10.197.153,122.10.197.155,122.10.197.156,122.10.197.157,122.10.197.158,122.10.197.159,122.10.197.16,122.10.197.160,122.10.197.161,122.10.197.162,122.10.197.163,122.10.197.164,122.10.197.165,122.10.197.166,122.10.197.167,122.10.197.168,122.10.197.169,122.10.197.17,122.10.197.170,122.10.197.171,122.10.197.172,122.10.197.173,122.10.197.174,122.10.197.175,122.10.197.176,122.10.197.177,122.10.197.178,122.10.197.179,122.10.197.18,122.10.197.180,122.10.197.181,122.10.197.182,122.10.197.183,122.10.197.184,122.10.197.185,122.10.197.186,122.10.197.187,122.10.197.188,122.10.197.189,122.10.197.19,122.10.197.190,122.10.197.191,122.10.197.192,122.10.197.193,122.10.197.194,122.10.197.195,122.10.197.196,122.10.197.197,122.10.197.198,122.10.197.199,122.10.197.20,122.10.197.200,122.10.197.201,122.10.197.202,122.10.197.203,122.10.197.204,122.10.197.205,122.10.197.206,122.10.197.207,122.10.197.208,122.10.197.209,122.10.197.21,122.10.197.210,122.10.197.211,122.10.197.212,122.10.197.213,122.10.197.214,122.10.197.215,122.10.197.216,122.10.197.217,122.10.197.218,122.10.197.219,122.10.197.22,122.10.197.220,122.10.197.221,122.10.197.222,122.10.197.23,122.10.197.24,122.10.197.25,122.10.197.26,122.10.197.27,122.10.197.28,122.10.197.29,122.10.197.30,122.10.197.31,122.10.197.32,122.10.197.33,122.10.197.34,122.10.197.35,122.10.197.36,122.10.197.37,122.10.197.38,122.10.197.39,122.10.197.4,122.10.197.40,122.10.197.41,122.10.197.42,122.10.197.43,122.10.197.44,122.10.197.45,122.10.197.46,122.10.197.47,122.10.197.48,122.10.197.49,122.10.197.5,122.10.197.50,122.10.197.51,122.10.197.52,122.10.197.53,122.10.197.54,122.10.197.55,122.10.197.56,122.10.197.57,122.10.197.58,122.10.197.59,122.10.197.6,122.10.197.60,122.10.197.61,122.10.197.62,122.10.197.63,122.10.197.64,122.10.197.65,122.10.197.66,122.10.197.67,122.10.197.68,122.10.197.69,122.10.197.7,122.10.197.70,122.10.197.71,122.10.197.72,122.10.197.73,122.10.197.74,122.10.197.75,122.10.197.76,122.10.197.77,122.10.197.78,122.10.197.79,122.10.197.8,122.10.197.80,122.10.197.81,122.10.197.82,122.10.197.83,122.10.197.84,122.10.197.85,122.10.197.86,122.10.197.87,122.10.197.88,122.10.197.89,122.10.197.9,122.10.197.90,122.10.197.91,122.10.197.92,122.10.197.93,122.10.197.94,122.10.197.95,122.10.197.96,122.10.197.97,122.10.197.98,122.10.197.99,128.1.119.122,128.1.119.123,128.1.119.124,128.1.119.125,128.1.119.126,129.227.191.10,129.227.191.100,129.227.191.101,129.227.191.102,129.227.191.103,129.227.191.104,129.227.191.105,129.227.191.106,129.227.191.107,129.227.191.108,129.227.191.109,129.227.191.11,129.227.191.110,129.227.191.111,129.227.191.112,129.227.191.113,129.227.191.114,129.227.191.115,129.227.191.116,129.227.191.117,129.227.191.118,129.227.191.119,129.227.191.12,129.227.191.120,129.227.191.121,129.227.191.122,129.227.191.123,129.227.191.124,129.227.191.125,129.227.191.126,129.227.191.13,129.227.191.130,129.227.191.131,129.227.191.132,129.227.191.133,129.227.191.134,129.227.191.135,129.227.191.136,129.227.191.137,129.227.191.138,129.227.191.139,129.227.191.14,129.227.191.140,129.227.191.141,129.227.191.142,129.227.191.143,129.227.191.144,129.227.191.145,129.227.191.146,129.227.191.147,129.227.191.148,129.227.191.149,129.227.191.15,129.227.191.150,129.227.191.151,129.227.191.152,129.227.191.153,129.227.191.154,129.227.191.155,129.227.191.156,129.227.191.157,129.227.191.158,129.227.191.16,129.227.191.162,129.227.191.163,129.227.191.164,129.227.191.165,129.227.191.166,129.227.191.167,129.227.191.168,129.227.191.169,129.227.191.17,129.227.191.170,129.227.191.171,129.227.191.172,129.227.191.173,129.227.191.174,129.227.191.175,129.227.191.176,129.227.191.177,129.227.191.178,129.227.191.18,129.227.191.19,129.227.191.194,129.227.191.195,129.227.191.196,129.227.191.197,129.227.191.199,129.227.191.2,129.227.191.20,129.227.191.200,129.227.191.201,129.227.191.202,129.227.191.203,129.227.191.204,129.227.191.205,129.227.191.206,129.227.191.207,129.227.191.208,129.227.191.209,129.227.191.21,129.227.191.210,129.227.191.211,129.227.191.212,129.227.191.213,129.227.191.214,129.227.191.215,129.227.191.216,129.227.191.217,129.227.191.218,129.227.191.219,129.227.191.22,129.227.191.220,129.227.191.221,129.227.191.222,129.227.191.223,129.227.191.224,129.227.191.225,129.227.191.226,129.227.191.227,129.227.191.228,129.227.191.229,129.227.191.23,129.227.191.230,129.227.191.231,129.227.191.232,129.227.191.233,129.227.191.234,129.227.191.235,129.227.191.236,129.227.191.237,129.227.191.238,129.227.191.239,129.227.191.24,129.227.191.240,129.227.191.241,129.227.191.242,129.227.191.243,129.227.191.244,129.227.191.245,129.227.191.246,129.227.191.247,129.227.191.248,129.227.191.249,129.227.191.25,129.227.191.250,129.227.191.252,129.227.191.253,129.227.191.254,129.227.191.26,129.227.191.27,129.227.191.28,129.227.191.29,129.227.191.3,129.227.191.30,129.227.191.31,129.227.191.32,129.227.191.33,129.227.191.34,129.227.191.35,129.227.191.36,129.227.191.37,129.227.191.38,129.227.191.39,129.227.191.4,129.227.191.40,129.227.191.41,129.227.191.42,129.227.191.43,129.227.191.44,129.227.191.45,129.227.191.46,129.227.191.47,129.227.191.48,129.227.191.49,129.227.191.5,129.227.191.50,129.227.191.52,129.227.191.53,129.227.191.54,129.227.191.55,129.227.191.56,129.227.191.57,129.227.191.58,129.227.191.59,129.227.191.6,129.227.191.60,129.227.191.61,129.227.191.62,129.227.191.63,129.227.191.64,129.227.191.65,129.227.191.66,129.227.191.67,129.227.191.68,129.227.191.69,129.227.191.7,129.227.191.70,129.227.191.71,129.227.191.72,129.227.191.73,129.227.191.74,129.227.191.75,129.227.191.76,129.227.191.77,129.227.191.78,129.227.191.79,129.227.191.8,129.227.191.80,129.227.191.81,129.227.191.82,129.227.191.83,129.227.191.84,129.227.191.85,129.227.191.86,129.227.191.87,129.227.191.88,129.227.191.89,129.227.191.9,129.227.191.90,129.227.191.91,129.227.191.92,129.227.191.93,129.227.191.94,129.227.191.95,129.227.191.96,129.227.191.97,129.227.191.98,129.227.191.99,129.227.235.10,129.227.235.100,129.227.235.101,129.227.235.102,129.227.235.104,129.227.235.105,129.227.235.106,129.227.235.107,129.227.235.109,129.227.235.110,129.227.235.111,129.227.235.112,129.227.235.113,129.227.235.117,129.227.235.118,129.227.235.119,129.227.235.12,129.227.235.120,129.227.235.121,129.227.235.122,129.227.235.123,129.227.235.124,129.227.235.125,129.227.235.126,129.227.235.13,129.227.235.132,129.227.235.133,129.227.235.134,129.227.235.135,129.227.235.136,129.227.235.138,129.227.235.140,129.227.235.141,129.227.235.142,129.227.235.143,129.227.235.146,129.227.235.147,129.227.235.149,129.227.235.15,129.227.235.150,129.227.235.151,129.227.235.152,129.227.235.153,129.227.235.16,129.227.235.18,129.227.235.19,129.227.235.20,129.227.235.21,129.227.235.22,129.227.235.23,129.227.235.24,129.227.235.25,129.227.235.26,129.227.235.29,129.227.235.30,129.227.235.31,129.227.235.32,129.227.235.33,129.227.235.35,129.227.235.36,129.227.235.37,129.227.235.38,129.227.235.39,129.227.235.4,129.227.235.42,129.227.235.43,129.227.235.45,129.227.235.46,129.227.235.47,129.227.235.48,129.227.235.49,129.227.235.5,129.227.235.50,129.227.235.51,129.227.235.52,129.227.235.54,129.227.235.56,129.227.235.57,129.227.235.58,129.227.235.63,129.227.235.65,129.227.235.69,129.227.235.7,129.227.235.70,129.227.235.72,129.227.235.73,129.227.235.74,129.227.235.75,129.227.235.79,129.227.235.8,129.227.235.84,129.227.235.87,129.227.235.88,129.227.235.89,129.227.235.9,129.227.235.90,129.227.235.91,129.227.235.92,129.227.235.93,129.227.235.94,129.227.235.95,129.227.235.98,129.227.235.99,147.75.93.79,156.59.221.100,156.59.221.187,156.59.221.188,156.59.221.189,156.59.221.190,156.59.221.191,156.59.221.192,156.59.221.193,156.59.221.238,156.59.221.239,156.59.221.240,156.59.221.241,156.59.221.242,156.59.221.243,156.59.221.244,156.59.221.92,156.59.221.93,156.59.221.96,156.59.221.97,156.59.221.98,185.189.242.10,185.189.242.100,185.189.242.101,185.189.242.102,185.189.242.103,185.189.242.104,185.189.242.105,185.189.242.106,185.189.242.107,185.189.242.108,185.189.242.109,185.189.242.11,185.189.242.110,185.189.242.111,185.189.242.112,185.189.242.113,185.189.242.114,185.189.242.115,185.189.242.116,185.189.242.117,185.189.242.118,185.189.242.119,185.189.242.12,185.189.242.120,185.189.242.121,185.189.242.122,185.189.242.123,185.189.242.13,185.189.242.132,185.189.242.133,185.189.242.134,185.189.242.135,185.189.242.136,185.189.242.137,185.189.242.138,185.189.242.139,185.189.242.14,185.189.242.140,185.189.242.141,185.189.242.142,185.189.242.143,185.189.242.144,185.189.242.145,185.189.242.146,185.189.242.147,185.189.242.148,185.189.242.149,185.189.242.15,185.189.242.150,185.189.242.151,185.189.242.152,185.189.242.153,185.189.242.154,185.189.242.155,185.189.242.156,185.189.242.157,185.189.242.158,185.189.242.159,185.189.242.16,185.189.242.160,185.189.242.161,185.189.242.162,185.189.242.163,185.189.242.164,185.189.242.165,185.189.242.166,185.189.242.167,185.189.242.17,185.189.242.18,185.189.242.19,185.189.242.20,185.189.242.21,185.189.242.22,185.189.242.23,185.189.242.24,185.189.242.25,185.189.242.26,185.189.242.27,185.189.242.28,185.189.242.29,185.189.242.30,185.189.242.31,185.189.242.32,185.189.242.33,185.189.242.34,185.189.242.35,185.189.242.36,185.189.242.37,185.189.242.38,185.189.242.39,185.189.242.4,185.189.242.40,185.189.242.41,185.189.242.42,185.189.242.43,185.189.242.44,185.189.242.45,185.189.242.46,185.189.242.47,185.189.242.48,185.189.242.49,185.189.242.5,185.189.242.50,185.189.242.51,185.189.242.52,185.189.242.53,185.189.242.54,185.189.242.55,185.189.242.56,185.189.242.57,185.189.242.58,185.189.242.59,185.189.242.6,185.189.242.60,185.189.242.61,185.189.242.62,185.189.242.63,185.189.242.64,185.189.242.65,185.189.242.66,185.189.242.67,185.189.242.68,185.189.242.69,185.189.242.7,185.189.242.70,185.189.242.71,185.189.242.72,185.189.242.73,185.189.242.74,185.189.242.75,185.189.242.76,185.189.242.77,185.189.242.78,185.189.242.79,185.189.242.8,185.189.242.80,185.189.242.81,185.189.242.82,185.189.242.83,185.189.242.84,185.189.242.85,185.189.242.86,185.189.242.87,185.189.242.88,185.189.242.89,185.189.242.9,185.189.242.90,185.189.242.91,185.189.242.92,185.189.242.93,185.189.242.94,185.189.242.95,185.189.242.96,185.189.242.97,185.189.242.98,185.189.242.99,198.44.237.10,198.44.237.11,198.44.237.12,198.44.237.13,198.44.237.14,198.44.237.15,198.44.237.16,198.44.237.162,198.44.237.163,198.44.237.164,198.44.237.166,198.44.237.167,198.44.237.168,198.44.237.169,198.44.237.17,198.44.237.170,198.44.237.171,198.44.237.172,198.44.237.19,198.44.237.194,198.44.237.195,198.44.237.196,198.44.237.197,198.44.237.198,198.44.237.199,198.44.237.2,198.44.237.20,198.44.237.200,198.44.237.201,198.44.237.202,198.44.237.203,198.44.237.204,198.44.237.205,198.44.237.206,198.44.237.207,198.44.237.208,198.44.237.209,198.44.237.21,198.44.237.210,198.44.237.211,198.44.237.212,198.44.237.213,198.44.237.214,198.44.237.215,198.44.237.216,198.44.237.217,198.44.237.218,198.44.237.219,198.44.237.22,198.44.237.220,198.44.237.221,198.44.237.222,198.44.237.223,198.44.237.224,198.44.237.225,198.44.237.226,198.44.237.227,198.44.237.228,198.44.237.229,198.44.237.23,198.44.237.230,198.44.237.231,198.44.237.232,198.44.237.233,198.44.237.3,198.44.237.4,198.44.237.5,198.44.237.6,198.44.237.66,198.44.237.67,198.44.237.68,198.44.237.69,198.44.237.7,198.44.237.70,198.44.237.71,198.44.237.72,198.44.237.73,198.44.237.74,198.44.237.75,198.44.237.76,198.44.237.77,198.44.237.78,198.44.237.79,198.44.237.8,198.44.237.80,198.44.237.81,198.44.237.82,198.44.237.83,198.44.237.84,198.44.237.85,198.44.237.86,198.44.237.87,198.44.237.88,198.44.237.89,198.44.237.9,198.44.237.90,198.44.237.91,198.44.237.92,198.44.237.93,198.44.237.94,198.44.237.95,198.44.237.96,198.44.237.97,198.44.237.99,198.44.239.10,198.44.239.11,198.44.239.114,198.44.239.12,198.44.239.13,198.44.239.139,198.44.239.14,198.44.239.15,198.44.239.153,198.44.239.16,198.44.239.17,198.44.239.18,198.44.239.19,198.44.239.2,198.44.239.20,198.44.239.202,198.44.239.204,198.44.239.205,198.44.239.21,198.44.239.210,198.44.239.212,198.44.239.215,198.44.239.216,198.44.239.217,198.44.239.218,198.44.239.219,198.44.239.22,198.44.239.220,198.44.239.221,198.44.239.222,198.44.239.223,198.44.239.224,198.44.239.225,198.44.239.226,198.44.239.227,198.44.239.228,198.44.239.23,198.44.239.234,198.44.239.235,198.44.239.236,198.44.239.237,198.44.239.238,198.44.239.239,198.44.239.24,198.44.239.240,198.44.239.241,198.44.239.242,198.44.239.243,198.44.239.244,198.44.239.245,198.44.239.246,198.44.239.247,198.44.239.248,198.44.239.249,198.44.239.25,198.44.239.250,198.44.239.251,198.44.239.252,198.44.239.253,198.44.239.254,198.44.239.26,198.44.239.27,198.44.239.28,198.44.239.29,198.44.239.3,198.44.239.30,198.44.239.31,198.44.239.32,198.44.239.33,198.44.239.34,198.44.239.35,198.44.239.36,198.44.239.37,198.44.239.38,198.44.239.39,198.44.239.4,198.44.239.41,198.44.239.42,198.44.239.43,198.44.239.44,198.44.239.45,198.44.239.46,198.44.239.47,198.44.239.48,198.44.239.49,198.44.239.5,198.44.239.50,198.44.239.51,198.44.239.52,198.44.239.53,198.44.239.54,198.44.239.55,198.44.239.56,198.44.239.57,198.44.239.58,198.44.239.59,198.44.239.6,198.44.239.60,198.44.239.62,198.44.239.63,198.44.239.64,198.44.239.65,198.44.239.66,198.44.239.67,198.44.239.68,198.44.239.69,198.44.239.7,198.44.239.70,198.44.239.71,198.44.239.72,198.44.239.73,198.44.239.74,198.44.239.75,198.44.239.76,198.44.239.77,198.44.239.78,198.44.239.79,198.44.239.8,198.44.239.83,198.44.239.9,198.44.239.94,198.44.239.98,203.34.110.10,203.34.110.100,203.34.110.101,203.34.110.102,203.34.110.103,203.34.110.104,203.34.110.106,203.34.110.107,203.34.110.108,203.34.110.109,203.34.110.11,203.34.110.110,203.34.110.111,203.34.110.112,203.34.110.113,203.34.110.114,203.34.110.116,203.34.110.117,203.34.110.118,203.34.110.119,203.34.110.12,203.34.110.120,203.34.110.121,203.34.110.122,203.34.110.123,203.34.110.124,203.34.110.125,203.34.110.126,203.34.110.127,203.34.110.128,203.34.110.129,203.34.110.13,203.34.110.130,203.34.110.131,203.34.110.132,203.34.110.133,203.34.110.134,203.34.110.135,203.34.110.136,203.34.110.137,203.34.110.138,203.34.110.139,203.34.110.14,203.34.110.15,203.34.110.16,203.34.110.17,203.34.110.18,203.34.110.19,203.34.110.2,203.34.110.20,203.34.110.21,203.34.110.22,203.34.110.23,203.34.110.24,203.34.110.25,203.34.110.26,203.34.110.27,203.34.110.28,203.34.110.29,203.34.110.3,203.34.110.30,203.34.110.31,203.34.110.32,203.34.110.33,203.34.110.34,203.34.110.35,203.34.110.36,203.34.110.37,203.34.110.38,203.34.110.39,203.34.110.4,203.34.110.40,203.34.110.41,203.34.110.42,203.34.110.43,203.34.110.44,203.34.110.45,203.34.110.46,203.34.110.47,203.34.110.48,203.34.110.49,203.34.110.5,203.34.110.50,203.34.110.51,203.34.110.52,203.34.110.53,203.34.110.54,203.34.110.55,203.34.110.56,203.34.110.57,203.34.110.58,203.34.110.59,203.34.110.6,203.34.110.60,203.34.110.61,203.34.110.62,203.34.110.63,203.34.110.64,203.34.110.65,203.34.110.66,203.34.110.67,203.34.110.68,203.34.110.69,203.34.110.7,203.34.110.70,203.34.110.71,203.34.110.72,203.34.110.73,203.34.110.74,203.34.110.75,203.34.110.76,203.34.110.77,203.34.110.78,203.34.110.79,203.34.110.8,203.34.110.80,203.34.110.81,203.34.110.82,203.34.110.83,203.34.110.84,203.34.110.85,203.34.110.86,203.34.110.87,203.34.110.88,203.34.110.89,203.34.110.9,203.34.110.90,203.34.110.91,203.34.110.92,203.34.110.93,203.34.110.94,203.34.110.95,203.34.110.96,203.34.110.97,203.34.110.98,203.34.110.99,61.4.123.10,61.4.123.100,61.4.123.101,61.4.123.102,61.4.123.103,61.4.123.104,61.4.123.105,61.4.123.106,61.4.123.107,61.4.123.108,61.4.123.109,61.4.123.11,61.4.123.110,61.4.123.111,61.4.123.112,61.4.123.113,61.4.123.114,61.4.123.115,61.4.123.116,61.4.123.117,61.4.123.118,61.4.123.119,61.4.123.12,61.4.123.120,61.4.123.121,61.4.123.122,61.4.123.123,61.4.123.124,61.4.123.125,61.4.123.13,61.4.123.132,61.4.123.133,61.4.123.134,61.4.123.135,61.4.123.136,61.4.123.137,61.4.123.138,61.4.123.139,61.4.123.14,61.4.123.140,61.4.123.141,61.4.123.142,61.4.123.143,61.4.123.144,61.4.123.145,61.4.123.146,61.4.123.147,61.4.123.148,61.4.123.149,61.4.123.15,61.4.123.150,61.4.123.151,61.4.123.152,61.4.123.153,61.4.123.154,61.4.123.155,61.4.123.156,61.4.123.157,61.4.123.158,61.4.123.159,61.4.123.16,61.4.123.160,61.4.123.161,61.4.123.162,61.4.123.163,61.4.123.164,61.4.123.165,61.4.123.166,61.4.123.167,61.4.123.168,61.4.123.169,61.4.123.17,61.4.123.170,61.4.123.171,61.4.123.172,61.4.123.173,61.4.123.174,61.4.123.175,61.4.123.176,61.4.123.177,61.4.123.178,61.4.123.179,61.4.123.18,61.4.123.180,61.4.123.181,61.4.123.182,61.4.123.183,61.4.123.184,61.4.123.19,61.4.123.20,61.4.123.21,61.4.123.23,61.4.123.24,61.4.123.25,61.4.123.26,61.4.123.27,61.4.123.28,61.4.123.29,61.4.123.30,61.4.123.31,61.4.123.32,61.4.123.33,61.4.123.34,61.4.123.35,61.4.123.36,61.4.123.37,61.4.123.38,61.4.123.39,61.4.123.4,61.4.123.40,61.4.123.41,61.4.123.42,61.4.123.43,61.4.123.44,61.4.123.45,61.4.123.46,61.4.123.47,61.4.123.48,61.4.123.49,61.4.123.5,61.4.123.50,61.4.123.51,61.4.123.52,61.4.123.53,61.4.123.54,61.4.123.55,61.4.123.56,61.4.123.57,61.4.123.58,61.4.123.59,61.4.123.6,61.4.123.60,61.4.123.61,61.4.123.62,61.4.123.63,61.4.123.64,61.4.123.65,61.4.123.66,61.4.123.67,61.4.123.68,61.4.123.69,61.4.123.7,61.4.123.70,61.4.123.71,61.4.123.72,61.4.123.73,61.4.123.74,61.4.123.75,61.4.123.76,61.4.123.77,61.4.123.78,61.4.123.79,61.4.123.8,61.4.123.80,61.4.123.81,61.4.123.82,61.4.123.83,61.4.123.84,61.4.123.85,61.4.123.86,61.4.123.87,61.4.123.88,61.4.123.89,61.4.123.9,61.4.123.90,61.4.123.91,61.4.123.92,61.4.123.93,61.4.123.94,61.4.123.95,61.4.123.96,61.4.123.97,61.4.123.98,61.4.123.99";

        String[] ips = ipStr.split(",");
        List<IpCityDTO> lists=new ArrayList<>();
        for (String ip : ips
        ) {
            IpCityDTO ipCityDTO=new IpCityDTO();
            ipCityDTO.setIp(ip);
            String city = findCity(ip);
            ipCityDTO.setCity( StringUtils.isBlank(city) ?findCountry(ip):city);
            lists.add(ipCityDTO);
            LOGGER.info("ipCityDTO:{}",ipCityDTO);
        }
        //输出ip城市 excel
        allResource.put("resource_type","2908三方资源");
        allResource.put("ip_city",lists);
        WriterResourceExcel.writerResourceExcel(allResource);



    }

    public static void main(String args[]) {
        Long st = System.nanoTime();
       try {
           queryIpCity();
       }catch (IOException e) {
           throw new RuntimeException(e);
       } catch (GeoIp2Exception e) {
           throw new RuntimeException(e);
       } catch (Exception e) {
           throw new RuntimeException(e);
       }

//            System.out.println("find:"+GeoLiteCity.find("122.10.197.199"));
        Long et = System.nanoTime();
        System.out.println((et - st));
    }
}

